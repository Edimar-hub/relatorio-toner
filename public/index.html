<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- CSS only -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <title>Title</title>
</head>
<body>

    <div id="app" class="container">
        <div class="row mt-2">
            <button  @click="abrirPlanilha" class="btn btn-info">exibir planilha</button>
            <button @click="formularioCadastroDeToner" class="btn btn-warning">Cadastrar Toner</button>
        </div>

        <div class="row mt-5" v-if="mostrarTabela" >
            <div class="col-sm-12 col-md-12">
                <table class="table striped table-striped table-hover table-sm table-responsive-sm">
                    <thead class="thead-dark">
                    <tr>
                        <th>#</th>
                        <th>Modelo</th>
                        <th>Marca</th>
                        <th>Tipo</th>
                        <th>Status</th>
                        <th>Recarga</th>
                        <th>Quantidade Pó</th>
                        <th>Opções</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr v-for="toner in toners" :key="toner.id">
                        <td>{{toner.id}}</td>
                        <td>{{toner.modelo}}</td>
                        <td>{{toner.marca}}</td>
                        <td>{{toner.tipo}}</td>
                        <td>{{toner.status}}</td>
                        <td>{{toner.recarga}}</td>
                        <td>{{toner.quantidade}}</td>
                        <td>
                            <button @click="editarToner(toner.id)" class="btn btn-sm btn-dark">Editar</button>
                            <button @click="apagarToner(toner.id)" class="btn btn-sm btn-danger">Apagar</button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="row mt-5" v-if="mostrarFormulario">
            <div class="row mx-auto">
                <div class="col-md-12 col-sm-12">
                <h3>Formulario para cadastro de toner</h3>
                    <div class="form-row">
                        <div class="form-group col-md-6 col-sm-12">
                            <label for="modelo">Modelo</label>
                            <input type="text" class="form-control" id="modelo" v-model="novoToner.modelo">
                        </div>
                        <div class="form-group col-md-6 col-sm-12">
                            <label for="marca">Marca</label>
                            <input type="text" class="form-control" id="marca" v-model="novoToner.marca">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6 col-sm-12">
                            <label for="tipo">Tipo</label>
                            <input type="text" class="form-control" id="tipo" v-model="novoToner.tipo">
                        </div>
                        <div class="form-group col-md-6 col-sm-12">
                            <label for="status">Status</label>
                            <input type="text" class="form-control" id="status" v-model="novoToner.status">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6 col-sm-12">
                            <label for="recarga">Recarga</label>
                            <input type="text" class="form-control" id="recarga" v-model="novoToner.recarga">
                        </div>
                        <div class="form-group col-md-6 col-sm-12">
                            <label for="quantidade">Quantidade</label>
                            <input type="number" class="form-control" id="quantidade" v-model="novoToner.quantidade">
                        </div>
                    </div>
                    <button class="btn btn-primary" @click="cadastrarToner()">Salvar</button>
                </div>
            </div>
        </div>

    </div>

    <!-- JS, Popper.js, and jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.20.0/axios.min.js" type="text/javascript"></script>

    <script type="module">
        const url = 'http://localhost:3000/toner'
        let app = new Vue({
            el: '#app',
            data(){
                return{
                    novoToner: {
                        modelo:'', marca:'', tipo:'', status:'', recarga:'', quantidade:''
                    },
                    toners: '',
                    mostrarTabela: false,
                    mostrarFormulario: false
                }
            },
            mounted() {

                axios.get(url,{
                    headers: {
                        "Access-Control-Allow-Origin": "*",
                        "Content-Type": "application/json;charset=UTF-8"
                    }
                })
                    .then(response => {
                        console.log(response.data)
                        this.toners = response.data
                    })
                    .catch(erro => console.error(erro));
            },
            methods: {
                abrirPlanilha(){
                    if (this.mostrarTabela){
                        this.mostrarTabela = false
                    }else{
                        this.mostrarTabela = true
                    }
                },
                formularioCadastroDeToner(){
                    if (this.mostrarFormulario){
                        this.mostrarFormulario = false
                    }else{
                        this.mostrarFormulario = true
                    }
                },
                cadastrarToner(){
                    console.log(this.novoToner)
                    axios.post(url, {
                        modelo: this.novoToner.modelo,
                        marca: this.novoToner.marca,
                        tipo: this.novoToner.tipo,
                        status: this.novoToner.status,
                        recarga: this.novoToner.recarga,
                        quantidae: this.novoToner.quantidae
                    })
                    .then(response => {

                        this.novoToner.modelo = ''
                        this.novoToner.marca = ''
                        this.novoToner.tipo = ''
                        this.novoToner.status = ''
                        this.novoToner.recarga = ''
                        this.novoToner.quantidade = ''

                        axios.get(url)
                            .then(response => {
                                console.log(response.data)
                                this.toners = response.data
                            })
                            .catch(erro => console.error(erro));
                    })
                    .catch(erro => console.error(erro));
                },
                apagarToner(id){
                    axios.delete(url+'/'+id)
                        .then(response => {
                            console.log(response.data)
                            axios.get(url)
                                .then(response => {
                                    console.log(response.data)
                                    this.toners = response.data
                                })
                                .catch(erro => console.error(erro));
                        })
                        .catch(erro => console.error(erro));
                }
            }
        })
    </script>
</body>
</html>